{# Personal Tokens Tab Content #}
<div id="personal-tokens-section" class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title">
			<i class="fas fa-key"></i> {{ 'Portal:PersonalTokens:Title'|dict_s }}
		</h3>
	</div>
	<div class="panel-body">
		<p class="text-muted">{{ 'Portal:PersonalTokens:Description'|dict_s }}</p>

		{# Success/Error messages #}
		{% if aData.success_message is defined %}
			<div class="alert alert-success">
				{{ aData.success_message }}
			</div>
		{% endif %}

		{% if aData.error_message is defined %}
			<div class="alert alert-danger">
				{{ aData.error_message }}
			</div>
		{% endif %}

		{# Show newly created token (only shown once) #}
		{% if aData.new_token_value is defined %}
			<div class="alert alert-warning">
				<h4>{{ 'Portal:PersonalTokens:CopyWarning'|dict_s }}</h4>
				<div class="form-group">
					<label>{{ 'Portal:PersonalTokens:YourToken'|dict_s }}</label>
					<div class="input-group">
						<input type="text" class="form-control" id="new-token-value" value="{{ aData.new_token_value }}" readonly>
						<span class="input-group-btn">
							<button class="btn btn-default" type="button" onclick="copyTokenToClipboard('new-token-value')">
								<i class="fas fa-copy"></i> {{ 'Portal:PersonalTokens:Copy'|dict_s }}
							</button>
						</span>
					</div>
				</div>
			</div>
		{% endif %}

		{# Create new token button #}
		{% if aData.can_create %}
			<div class="form-group">
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createTokenModal">
					<i class="fas fa-plus"></i> {{ 'Portal:PersonalTokens:CreateNew'|dict_s }}
				</button>
				<span class="text-muted">({{ aData.tokens|length }} / {{ aData.max_tokens }})</span>
			</div>
		{% else %}
			<div class="alert alert-info">
				{{ 'Portal:PersonalTokens:MaxTokensReached'|dict_s|format(aData.max_tokens) }}
			</div>
		{% endif %}

		{# Tokens list #}
		{% if aData.tokens is empty %}
			<div class="well text-center">
				<p class="text-muted">{{ 'Portal:PersonalTokens:NoTokens'|dict_s }}</p>
			</div>
		{% else %}
			<div class="table-responsive">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>{{ 'Portal:PersonalTokens:Application'|dict_s }}</th>
							<th>{{ 'Portal:PersonalTokens:Scope'|dict_s }}</th>
							<th>{{ 'Portal:PersonalTokens:ExpiryDate'|dict_s }}</th>
							<th>{{ 'Portal:PersonalTokens:LastUsed'|dict_s }}</th>
							<th>{{ 'Portal:PersonalTokens:UseCount'|dict_s }}</th>
							<th>{{ 'Portal:PersonalTokens:Actions'|dict_s }}</th>
						</tr>
					</thead>
					<tbody>
						{% for token in aData.tokens %}
							<tr>
								<td><strong>{{ token.application }}</strong></td>
								<td><span class="label label-info">{{ token.scope }}</span></td>
								<td>{{ token.expiration_date|date('Y-m-d H:i') }}</td>
								<td>{{ token.last_use_date ? token.last_use_date|date('Y-m-d H:i') : '-' }}</td>
								<td>{{ token.use_count }}</td>
								<td>
									<div class="btn-group btn-group-xs">
										<button type="button" class="btn btn-warning"
												onclick="confirmRegenerateToken({{ token.id }}, '{{ token.application|escape('js') }}')"
												title="{{ 'Portal:PersonalTokens:Regenerate'|dict_s }}">
											<i class="fas fa-sync"></i>
										</button>
										<button type="button" class="btn btn-danger"
												onclick="confirmDeleteToken({{ token.id }}, '{{ token.application|escape('js') }}')"
												title="{{ 'Portal:PersonalTokens:Delete'|dict_s }}">
											<i class="fas fa-trash"></i>
										</button>
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	</div>
</div>

{# Create Token Modal #}
<div class="modal fade" id="createTokenModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<form method="POST" id="createTokenForm" onsubmit="return handleTokenFormSubmit(event);">
				<input type="hidden" name="token_action" value="create">
				<input type="hidden" name="transaction_id" value="{{ aData.sTransactionId }}">

				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<i class="fas fa-plus"></i> {{ 'Portal:PersonalTokens:CreateNew'|dict_s }}
					</h4>
				</div>

				<div class="modal-body">
					<div class="form-group">
						<label for="token_application">{{ 'Portal:PersonalTokens:Application'|dict_s }} *</label>
						<input type="text"
							   class="form-control"
							   id="token_application"
							   name="application"
							   placeholder="{{ 'Portal:PersonalTokens:Application:Placeholder'|dict_s }}"
							   required>
						<p class="help-block">{{ 'Portal:PersonalTokens:Application:Help'|dict_s }}</p>
					</div>

					<div class="form-group">
						<label for="token_scope">{{ 'Portal:PersonalTokens:Scope'|dict_s }}</label>
						<select class="form-control" id="token_scope" name="scope">
							<option value="REST/JSON">REST/JSON</option>
							<option value="REST/JSON,Export">REST/JSON + Export</option>
						</select>
					</div>

					<div class="form-group">
						<label for="token_expiry_days">{{ 'Portal:PersonalTokens:ExpiryDays'|dict_s }}</label>
						<select class="form-control" id="token_expiry_days" name="expiry_days">
							<option value="30">30 {{ 'Portal:PersonalTokens:Days'|dict_s }}</option>
							<option value="90" selected>90 {{ 'Portal:PersonalTokens:Days'|dict_s }}</option>
							<option value="180">180 {{ 'Portal:PersonalTokens:Days'|dict_s }}</option>
							<option value="365">365 {{ 'Portal:PersonalTokens:Days'|dict_s }}</option>
						</select>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						{{ 'Portal:Button:Cancel'|dict_s }}
					</button>
					<button type="submit" class="btn btn-primary">
						<i class="fas fa-plus"></i> {{ 'Portal:PersonalTokens:Create'|dict_s }}
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

{# Hidden form for delete/regenerate actions #}
<form method="POST" id="tokenActionForm" style="display: none;">
	<input type="hidden" name="token_action" id="token_action_type">
	<input type="hidden" name="token_id" id="token_action_id">
	<input type="hidden" name="transaction_id" value="{{ aData.sTransactionId }}">
</form>
