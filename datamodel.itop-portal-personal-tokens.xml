<?xml version="1.0" encoding="UTF-8"?>
<itop_design xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="3.1">
  <classes/>
  <menus/>
  <user_rights>
    <profiles>
      <!-- Extend Portal User profile to allow PersonalToken management -->
      <profile id="2" _delta="must_exist">
        <groups>
          <group id="PersonalToken" _delta="define">
            <actions>
              <action id="action:read">allow</action>
              <action id="action:write">allow</action>
              <action id="action:delete">allow</action>
            </actions>
          </group>
        </groups>
      </profile>
      
      <!-- Optional: Create a dedicated Portal REST User profile -->
      <profile id="1025" _delta="define">
        <name>Portal REST User</name>
        <description>Portal user with REST API access via personal tokens</description>
        <groups>
          <!-- Inherit all Portal User permissions -->
          <group id="Portal">
            <actions>
              <action id="action:write">allow</action>
              <action id="action:delete">allow</action>
            </actions>
          </group>
          <group id="UserRequest">
            <actions>
              <action id="action:write">allow</action>
              <action id="stimulus:ev_close">allow</action>
              <action id="stimulus:ev_reopen">allow</action>
            </actions>
          </group>
          <!-- Add PersonalToken management -->
          <group id="PersonalToken">
            <actions>
              <action id="action:read">allow</action>
              <action id="action:write">allow</action>
              <action id="action:delete">allow</action>
            </actions>
          </group>
          <!-- Read access to everything else -->
          <group id="*">
            <actions>
              <action id="action:read">allow</action>
              <action id="action:bulk read">allow</action>
            </actions>
          </group>
        </groups>
      </profile>
    </profiles>
  </user_rights>
  
  <!-- Portal configuration -->
  <portals>
    <portal id="itop-portal" _delta="must_exist">
      <bricks>
        <!-- Add Personal Tokens tab to user profile brick -->
        <brick id="user-profile" xsi:type="Combodo\iTop\Portal\Brick\UserProfileBrick" _delta="must_exist">
          <tabs>
            <tab id="personal_tokens" _delta="define">
              <rank>40</rank>
              <title>Personal Tokens</title>
              <template>itop-portal-personal-tokens::personal_tokens</template>
            </tab>
          </tabs>
        </brick>
      </bricks>
    </portal>
  </portals>
</itop_design>